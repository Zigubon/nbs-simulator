<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>ZIGUBON Forest Simulator</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.50.0/build/stlite.css">
</head>
<body>
  <div id="root"></div>
  <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.50.0/build/stlite.js"></script>
  <script>
    stlite.mount({
      requirements: ["streamlit", "pandas", "numpy", "plotly", "scipy"],
      entrypoint: "app_v2.py",
      files: {
        /* [ì¤‘ìš”] ì—¬ê¸°ì— ê¸°ì¡´ íŒŒì´ì¬ íŒŒì¼(app_v2.py) ë‚´ìš©ì„ ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤.
           ì›ë˜ëŠ” íŒŒì¼ì„ ì½ì–´ì˜¬ ìˆ˜ë„ ìˆì§€ë§Œ, GitHub Pages CORS ë¬¸ì œ ë°©ì§€ë¥¼ ìœ„í•´
           ì½”ë“œë¥¼ ì§ì ‘ ì—¬ê¸°ì— ë°•ì•„ë„£ëŠ” ê²Œ ê°€ì¥ í™•ì‹¤í•©ë‹ˆë‹¤.
        */
        "app_v2.py": `
import streamlit as st
import pandas as pd
import numpy as np
import plotly.graph_objects as go

# 1. í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="ZIGUBON Simulator", page_icon="ğŸŒ²", layout="wide")

# 2. ë°ì´í„° ë¡œë“œ (stliteì—ì„œëŠ” íŒŒì¼ ì½ê¸°ê°€ ë¡œì»¬ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆì–´ ì§ì ‘ ë¡œë“œí•˜ê±°ë‚˜ URL ì‚¬ìš©)
# GitHub Pagesì— ì˜¬ë¼ê°„ CSV íŒŒì¼ì˜ 'Raw' ì£¼ì†Œë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
# ì•„ë˜ ì£¼ì†ŒëŠ” ì˜ˆì‹œì´ë¯€ë¡œ ë³¸ì¸ì˜ ë ˆí¬ì§€í† ë¦¬ ì£¼ì†Œë¡œ ë°”ê¿”ì£¼ì„¸ìš”.
# ë§Œì•½ ê°™ì€ í´ë”ì— ìˆë‹¤ë©´ http ìš”ì²­ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.

@st.cache_data
def load_data():
    # pandasê°€ ë¸Œë¼ìš°ì € ì•ˆì—ì„œ íŒŒì¼ì„ ì°¾ìœ¼ë ¤ë©´ fetchê°€ í•„ìš”í•©ë‹ˆë‹¤.
    # ê°€ì¥ ì‰¬ìš´ ë°©ë²•: GitHub Raw URL ì‚¬ìš©
    base_url = "https://raw.githubusercontent.com/zigubon/nbs-simulator/main/"
    
    # [ìˆ˜ì • í¬ì¸íŠ¸] ë³¸ì¸ì˜ ë ˆí¬ì§€í† ë¦¬ ì´ë¦„ì´ nbs-simulatorê°€ ì•„ë‹ˆë¼ë©´ ìœ„ ì£¼ì†Œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”!
    
    forest = pd.read_csv(base_url + "forest_data_2026.csv")
    price = pd.read_csv(base_url + "carbon_price_scenarios.csv")
    benefit = pd.read_csv(base_url + "co_benefits.csv")
    return forest, price, benefit

try:
    df_forest, df_price, df_benefit = load_data()
except Exception as e:
    st.error(f"ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. CSV íŒŒì¼ì´ GitHubì— ì˜¬ë¼ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.\\nì—ëŸ¬: {e}")
    st.stop()

# -----------------------------------------------------------
# 3. UI ë° ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ (ê¸°ì¡´ app_v2.py ë¡œì§)
# -----------------------------------------------------------

st.title("ğŸŒ² ì‚°ë¦¼íƒ„ì†Œìƒì‡„ ì‹œë®¬ë ˆì´í„° (Serverless)")
st.caption("Powered by ZIGUBON & stlite (Running entirely in your browser)")

# ì‚¬ì´ë“œë°” ì»¨íŠ¸ë¡¤
with st.sidebar:
    st.header("âš™ï¸ ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •")
    area = st.number_input("ì‚¬ì—… ë©´ì  (ha)", min_value=1, value=10)
    project_period = st.slider("ì‚¬ì—… ê¸°ê°„ (ë…„)", 10, 50, 30)
    
    st.subheader("ìˆ˜ì¢… ì„ íƒ")
    species_list = df_forest['name'].unique()
    selected_species = st.multiselect("ì‹ì¬ ìˆ˜ì¢… (í˜¼íš¨ë¦¼ êµ¬ì„±)", species_list, default=[species_list[0]])
    
    if not selected_species:
        st.warning("ìˆ˜ì¢…ì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.")
        st.stop()

# ë©”ì¸ ê³„ì‚° ë¡œì§
years = range(2026, 2026 + project_period + 1)
chart_data = []

# (ê°„ë‹¨í•œ ì‹œë®¬ë ˆì´ì…˜ ë¡œì§ ì˜ˆì‹œ - ì‹¤ì œ ë³µì¡í•œ ë¡œì§ì€ ì—¬ê¸°ì— ê·¸ëŒ€ë¡œ ì“°ì‹œë©´ ë©ë‹ˆë‹¤)
total_uptake = 0
for sp in selected_species:
    # í•´ë‹¹ ìˆ˜ì¢… ë°ì´í„° í•„í„°ë§ (ì˜ˆì‹œ)
    sp_data = df_forest[df_forest['name'] == sp].iloc[0]
    # ì„±ì¥ ê³¡ì„  (ë‹¨ìˆœí™”: 5ë…„ ë‹¨ìœ„ ë°ì´í„°ë¥¼ ì„ í˜• ë³´ê°„í•œë‹¤ê³  ê°€ì •)
    # ì‹¤ì œë¡œëŠ” ë³µì¡í•œ ë³´ê°„ë²• ì‚¬ìš© ê°€ëŠ¥
    growth_rate = sp_data['co2_yr_50'] / 50 # ë‹¨ìˆœ í‰ê·  ì„±ì¥ë¥  ê°€ì •
    
    uptake = [i * growth_rate * (area / len(selected_species)) for i in range(project_period + 1)]
    chart_data.append(go.Scatter(x=list(years), y=uptake, name=sp, stackgroup='one'))
    total_uptake += uptake[-1]

# ì°¨íŠ¸ ê·¸ë¦¬ê¸°
fig = go.Figure(data=chart_data)
fig.update_layout(title="ì—°ë„ë³„ ëˆ„ì  íƒ„ì†Œ í¡ìˆ˜ëŸ‰", xaxis_title="ì—°ë„", yaxis_title="tCO2")
st.plotly_chart(fig, use_container_width=True)

# ê²°ê³¼ ì§€í‘œ
col1, col2 = st.columns(2)
col1.metric("ì´ ì˜ˆìƒ í¡ìˆ˜ëŸ‰", f"{total_uptake:.1f} tCOâ‚‚")
col2.metric("ì˜ˆìƒ ê°€ì¹˜ (í˜„ì¬ê°€)", f"â‚©{total_uptake * 15000:,.0f}")

`
      }
    })
  </script>
</body>
</html>
